const express = require('express');
const cors = require('cors');
const morgan = require('morgan');
const router = require('./api/routes');
const { PORT, IS_DEV } = require('./env');
const { sequelize } = require('./models');
const { stream } = require('./errors/winston');
const { notFound, errorHandler } = require('./errors/handler');
const cookieParser = require('cookie-parser');

const app = express();

app.set('port', PORT || 3003);

//db connect
sequelize.sync({ force: false })   //force가 true이면 DB에 있는 모든 정보를 지우고 다시 만든다.
    .then(() => {
        console.log('DB connected!');
        sequelize.query("SET foreign_key_checks = 0");
        sequelize.query("TRUNCATE TABLE exercises");
        sequelize.query("SET foreign_key_checks = 1");
        sequelize.query("insert into exercises (part, equipment, name, unit) values ('가슴', '바벨', '바벨 벤치프레스', '0'), ('가슴', '바벨', '바벨 인클라인 벤치프레스', '0'), ('가슴', '바벨', '바벨 디클라인 벤치프레스', '0'), ('가슴', '바벨', '바벨 와이드 그립 벤치프레스', '0'), ('가슴', '바벨', '바벨 와이드 그립 인클라인 벤치프레스', '0'), ('가슴', '바벨', '바벨 와이드 그립 디클라인 벤치프레스', '0'), ('가슴', '바벨', '바벨 내로우 그립 벤치프레스', '0'), ('가슴', '바벨', '바벨 내로우 그립 인클라인 벤치프레스', '0'), ('가슴', '바벨', '바벨 내로우 그립 디클라인 벤치프레스', '0'), ('가슴', '바벨', '바벨 인버스 그립 벤치프레스', '0'), ('가슴', '바벨', '바벨 풀오버', '0'), ('가슴', '바벨', '바벨 디클라인 풀오버', '0'), ('가슴', '덤벨', '덤벨 벤치프레스', '0'), ('가슴', '덤벨', '덤벨 인클라인 벤치프레스', '0'), ('가슴', '덤벨', '덤벨 디클라인 벤치프레스', '0'), ('가슴', '덤벨', '덤벨 플라이', '0'), ('가슴', '덤벨', '덤벨 인클라인 플라이', '0'), ('가슴', '덤벨', '덤벨 디클라인 플라이', '0'), ('가슴', '머신', '프레스 머신', '0'), ('가슴', '머신', '딥스 머신(가슴)', '0'), ('가슴', '머신', '펙 덱 머신', '0'), ('가슴', '케이블', '케이블 플라이', '0'), ('가슴', '케이블', '케이블 체스트 프레스', '0'), ('가슴', '밴드', '밴드 플라이', '0'), ('가슴', '밴드', '밴드 체스트 프레스', '0'), ('가슴', '플레이트', '중량 딥스(가슴)', '0'), ('가슴', '플레이트', '플레이트 프레스', '0'), ('가슴', '플레이트', '인클라인 플레이트 프레스', '0'), ('가슴', '플레이트', '디클라인 플레이트 프레스', '0'), ('가슴', '맨몸운동', '푸쉬업', '1'), ('가슴', '맨몸운동', '클로즈 핸드 푸쉬업', '1'), ('가슴', '맨몸운동', '손뼉 푸쉬업', '1'), ('가슴', '맨몸운동', '인클라인 푸쉬업', '1'), ('가슴', '맨몸운동', '디클라인 푸쉬업', '1'), ('가슴', '맨몸운동', '맨몸 딥스(가슴)', '1'), ('등', '바벨', '바벨 데드리프트', '0'), ('등', '바벨', '바벨 루마니안 데드리프트', '0'), ('등', '바벨', '바벨 스티프 데드리프트', '0'), ('등', '바벨', '바벨 스모 데드리프트', '0'), ('등', '바벨', '바벨 원레그 데드리프트', '0'), ('등', '바벨', '바벨 벤트오버 로우', '0'), ('등', '바벨', '바벨 리버스그립 벤트오버 로우', '0'), ('등', '바벨', '바벨 인클라인 벤치 로우', '0'), ('등', '바벨', '바벨 리버스 그립 인클라인 벤치 로우', '0'), ('등', '바벨', '티 바 로우', '0'), ('등', '바벨', '바벨 굿모닝', '0'), ('등', '바벨', '바벨 시티드 굿모닝', '0'), ('등', '덤벨', '덤벨 원 암 로우', '0'), ('등', '덤벨', '덤벨 벤트오버 로우', '0'), ('등', '덤벨', '덤벨 데드리프트', '0'), ('등', '덤벨', '덤벨 인클라인 벤치 원 암 로우', '0'), ('등', '덤벨', '덤벨 인클라인 벤치 투 암 로우', '0'), ('등', 'EZ바', 'EZ바 로우', '0'), ('등', 'EZ바', 'EZ바 리버스 그립 로우', '0'), ('등', '머신', '스미스 머신 데드리프트', '0'), ('등', '머신', '와이드 그립 랫 풀다운', '0'), ('등', '머신', '내로우 그립 랫 풀다운', '0'), ('등', '머신', '리버스 그립 랫 풀다운', '0'), ('등', '머신', '랫 풀다운 비하인드 넥', '0'), ('등', '머신', 'V바 랫 풀다운', '0'), ('등', '머신', '라잉 티 바 로우', '0'), ('등', '머신', '버티컬 로우', '0'), ('등', '머신', '리버스 그립 버티컬 로우', '0'), ('등', '머신', '스미스 머신 벤트오버 로우', '0'), ('등', '머신', '스미스 머신 리버스 그립 벤트오버 로우', '0'), ('등', '머신', '머신 어시스티드 풀 업', '0'), ('등', '머신', '머신 어시스티드 친 업', '0'), ('등', '머신', '스미스 머신 굿모닝', '0'), ('등', '케이블', '케이블 암 풀 다운', '0'), ('등', '케이블', '케이블 로프 암 풀 다운', '0'), ('등', '케이블', '케이블 시티드 로우', '0'), ('등', '케이블', '케이블 원 암 시티드 로우', '0'), ('등', '케이블', '케이블 스탠딩 로우', '0'), ('등', '케이블', '케이블 스탠딩 원 암 로우', '0'), ('등', '케이블', '케이블 로프 시티드 로우', '0'), ('등', '케이블', '케이블 원 암 랫 풀다운', '0'), ('등', '케이블', '케이블 V바 로우', '0'), ('등', '케틀벨', '케틀벨 데드리프트', '0'), ('등', '케틀벨', '케틀벨 투 암 로우', '0'), ('등', '케틀벨', '케틀벨 원 암 로우', '0'), ('등', '플레이트', '플레이트 백 익스텐션', '0'), ('등', '맨몸운동', '슈퍼맨', '1'), ('등', '맨몸운동', '백 익스텐션', '1'), ('등', '맨몸운동', '인버티드 로우', '1'), ('어깨', '바벨', '바벨 스탠딩 밀리터리 프레스', '0'), ('어깨', '바벨', '바벨 시티드 밀리터리 프레스', '0'), ('어깨', '바벨', '바벨 비하인드 숄더 프레스', '0'), ('어깨', '바벨', '바벨 슈러그', '0'), ('어깨', '바벨', '바벨 업 라이트 로우', '0'), ('어깨', '바벨', '바벨 프론트 레이즈', '0'), ('어깨', '덤벨', '덤벨 숄더 프레스', '0'), ('어깨', '덤벨', '덤벨 아놀드 프레스', '0'), ('어깨', '덤벨', '덤벨 사이드 레터럴 레이즈', '0'), ('어깨', '덤벨', '덤벨 프론트 레이즈', '0'), ('어깨', '덤벨', '덤벨 슈러그', '0'), ('어깨', '덤벨', '덤벨 업라이트 로우', '0'), ('어깨', '덤벨', '덤벨 시티드 리버스 플라이', '0'), ('어깨', '덤벨', '덤벨 라잉 리버스 플라이', '0'), ('어깨', '덤벨', '덤벨 원 암 리버스 플라이', '0'), ('어깨', '머신', '머신 리버스 펙 덱 플라이', '0'), ('어깨', '머신', '머신 숄더 프레스', '0'), ('어깨', '머신', '스미스 머신 슈러그', '0'), ('어깨', '머신', '스미스 머신 밀리터리 프레스', '0'), ('어깨', '머신', '스미스 머신 업라이트 로우', '0'), ('어깨', '케이블', '케이블 업 라이트 로우', '0'), ('어깨', '케이블', '케이블 레터럴 레이즈', '0'), ('어깨', '케이블', '케이블 프론트 레이즈', '0'), ('어깨', '케이블', '케이블 슈러그', '0'), ('어깨', '케이블', '케이블 로프 페이스 풀', '0'), ('어깨', '케이블', '케이블 리버스 플라이', '0'), ('어깨', '케이블', '케이블 원 암 리버스 플라이', '0'), ('어깨', '케틀벨', '케틀벨 밀리터리 프레스', '0'), ('어깨', '케틀벨', '케틀벨 더블 밀리터리 프레스', '0'), ('어깨', '케틀벨', '케틀벨 레터럴 레이즈', '0'), ('어깨', '케틀벨', '케틀벨 프론트 레이즈', '0'), ('어깨', '밴드', '밴드 업라이트 로우', '0'), ('어깨', '밴드', '밴드 레터럴 레이즈', '0'), ('어깨', '밴드', '밴드 프론트 레이즈', '0'), ('어깨', '밴드', '밴드 숄더 프레스', '0'), ('어깨', '플레이트', '플레이트 프론트 레이즈', '0'), ('어깨', '플레이트', '플레이트 슈러그', '0'), ('어깨', '플레이트', '플레이트 원 암 슈러그', '0'), ('어깨', '플레이트', '플레이트 사이드 레터럴 레이즈', '0'), ('어깨', '맨몸운동', '물구나무 푸쉬업', '1'), ('하체', '바벨', '바벨 스쿼트', '0'), ('하체', '바벨', '바벨 프론트 스쿼트', '0'), ('하체', '바벨', '바벨 와이드 스쿼트', '0'), ('하체', '바벨', '바벨 내로우 스쿼트', '0'), ('하체', '바벨', '바벨 핵 스쿼트', '0'), ('하체', '바벨', '바벨 점프 스쿼트', '0'), ('하체', '바벨', '바벨 런지', '0'), ('하체', '바벨', '바벨 스탠딩 카프레이즈', '0'), ('하체', '바벨', '바벨 스티프 레그 데드리프트', '0'), ('하체', '바벨', '바벨 원레그 스쿼트', '0'), ('하체', '바벨', '바벨 오버헤드 스쿼트', '0'), ('하체', '바벨', '바벨 클린', '0'), ('하체', '바벨', '바벨 스내치', '0'), ('하체', '바벨', '바벨 힙스러스트', '0'), ('하체', '바벨', '바벨 워킹 런지', '0'), ('하체', '덤벨', '덤벨 스쿼트', '0'), ('하체', '덤벨', '덤벨 런지', '0'), ('하체', '덤벨', '덤벨 워킹 런지', '0'), ('하체', '덤벨', '덤벨 스텝 업', '0'), ('하체', '덤벨', '덤벨 카프 레이즈', '0'), ('하체', '머신', '스미스 머신 스쿼트', '0'), ('하체', '머신', '핵 스쿼트', '0'), ('하체', '머신', '레그 프레스', '0'), ('하체', '머신', '원 레그 프레스', '0'), ('하체', '머신', '레그 익스텐션', '0'), ('하체', '머신', '원 레그 익스텐션', '0'), ('하체', '머신', '라잉 레그 컬', '0'), ('하체', '머신', '시티드 레그 컬', '0'), ('하체', '머신', '카프 프레스', '0'), ('하체', '머신', '머신 카프 레이즈', '0'), ('하체', '머신', '핵 카프 레이즈', '0'), ('하체', '머신', '이너 타이', '0'), ('하체', '머신', '아우터 타이', '0'), ('하체', '케틀벨', '케틀벨 원 암 스윙', '0'), ('하체', '케틀벨', '케틀벨 프론트 스쿼트', '0'), ('하체', '케틀벨', '케틀벨 데드 클린', '0'), ('하체', '밴드', '밴드 스쿼트', '0'), ('하체', '밴드', '밴드 카프 레이즈', '0'), ('하체', '밴드', '밴드 덩키 킥', '0'), ('하체', '플레이트', '플레이트 스쿼트', '0'), ('하체', '맨몸운동', '맨몸 스쿼트', '1'), ('하체', '맨몸운동', '맨몸 런지', '1'), ('하체', '맨몸운동', '맨몸 워킹 런지', '1'), ('하체', '맨몸운동', '맨몸 덩키 킥', '1'), ('하체', '맨몸운동', '맨몸 힙스러스트', '1'), ('하체', '맨몸운동', '프론트 스텝업', '1'), ('하체', '맨몸운동', '카프 레이즈', '1'), ('하체', '맨몸운동', '시티드 카프 레이즈', '1'), ('이두', '바벨', '바벨 컬', '0'), ('이두', '바벨', '바벨 프리쳐 컬', '0'), ('이두', '바벨', '시티드 바벨 컬', '0'), ('이두', '바벨', '바벨 클로즈 그립 컬', '0'), ('이두', '바벨', '바벨 와이드 그립 컬', '0'), ('이두', '덤벨', '인클라인 벤치 덤벨 컬', '0'), ('이두', '덤벨', '시티드 덤벨 컬', '0'), ('이두', '덤벨', '덤벨 스파이더 컬', '0'), ('이두', '덤벨', '덤벨 해머 컬', '0'), ('이두', '덤벨', '시티드 덤벨 해머 컬', '0'), ('이두', 'EZ바', 'EZ바 컬', '0'), ('이두', 'EZ바', '시티드 EZ바 컬', '0'), ('이두', '머신', '머신 컬', '0'), ('이두', '머신', '머신 내로우 그립 컬', '0'), ('이두', '케이블', '케이블 암 컬', '0'), ('이두', '케이블', '케이블 원 암 컬', '0'), ('이두', '케이블', '케이블 내로우 암 컬', '0'), ('이두', '케이블', '케이블 와이드 암 컬', '0'), ('이두', '케이블', '케이블 리버스 암 컬', '0'), ('이두', '케틀벨', '케틀벨 컬', '0'), ('이두', '플레이트', '플레이트 컬', '0'), ('이두', '맨몸운동', '친업(이두)', '1'), ('이두', '맨몸운동', '풀업(이두)', '1'), ('삼두', '바벨', '바벨 스탠딩 익스텐션', '0'), ('삼두', '바벨', '바벨 시티드 익스텐션', '0'), ('삼두', '바벨', '바벨 라잉 익스텐션', '0'), ('삼두', '바벨', '바벨 인클라인 익스텐션', '0'), ('삼두', '바벨', '바벨 클로즈 그립 벤치프레스', '0'), ('삼두', '바벨', '바벨 인클라인 클로즈 그립 벤치프레스', '0'), ('삼두', '덤벨', '덤벨 스탠딩 익스텐션', '0'), ('삼두', '덤벨', '덤벨 스탠딩 원 암 익스텐션', '0'), ('삼두', '덤벨', '덤벨 킥백', '0'), ('삼두', '덤벨', '덤벨 시티드 익스텐션', '0'), ('삼두', '덤벨', '덤벨 시티드 원 암 익스텐션', '0'), ('삼두', '덤벨', '덤벨 라잉 익스텐션', '0'), ('삼두', '덤벨', '덤벨 라잉 원 암 익스텐션', '0'), ('삼두', '덤벨', '덤벨 인클라인 익스텐션', '0'), ('삼두', '덤벨', '덤벨 인클라인 원 암 익스텐션', '0'), ('삼두', 'EZ바', 'EZ바 스탠딩 익스텐션', '0'), ('삼두', 'EZ바', 'EZ바 스탠딩 원 암 익스텐션', '0'), ('삼두', 'EZ바', 'EZ바 시티드 익스텐션', '0'), ('삼두', 'EZ바', 'EZ바 시티드 원 암 익스텐션', '0'), ('삼두', 'EZ바', 'EZ바 라잉 익스텐션', '0'), ('삼두', 'EZ바', 'EZ바 라잉 원 암 익스텐션', '0'), ('삼두', 'EZ바', 'EZ바 인클라인 익스텐션', '0'), ('삼두', 'EZ바', 'EZ바 인클라인 원 암 익스텐션', '0'), ('삼두', '머신', '스미스머신 클로즈그립 벤치프레스', '0'), ('삼두', '머신', '스미스머신 인클라인 클로즈그립 벤치프레스', '0'), ('삼두', '머신', '스미스머신 인클라인 라잉 익스텐션', '0'), ('삼두', '머신', '스미스머신 라잉 익스텐션', '0'), ('삼두', '머신', 'V bar 푸쉬다운', '0'), ('삼두', '머신', '딥스 머신(삼두)', '0'), ('삼두', '머신', '딥스 어시스트 머신(삼두)', '0'), ('삼두', '케이블', '케이블 로프 푸쉬다운', '0'), ('삼두', '케이블', '케이블 푸쉬다운', '0'), ('삼두', '케이블', '케이블 리버스그립 푸쉬다운', '0'), ('삼두', '케이블', '케이블 원 암 푸쉬다운', '0'), ('삼두', '케이블', '케이블 로프 오버헤드 익스텐션', '0'), ('삼두', '케이블', '케이블 원 암 익스텐션', '0'), ('삼두', '케이블', '케이블 라잉 익스텐션', '0'), ('삼두', '케이블', '케이블 킥백', '0'), ('삼두', '플레이트', '중량 딥스(삼두)', '0'), ('삼두', '맨몸운동', '클로즈 푸쉬업(삼두)', '1'), ('삼두', '맨몸운동', '맨몸 딥스(삼두)', '1'), ('복근', '바벨', '바벨 프레스 싯업', '0'), ('복근', '바벨', '바벨 시티드 트위스트', '0'), ('복근', '바벨', '바벨 사이드 벤드', '0'), ('복근', '덤벨', '덤벨 프레스 싯업', '0'), ('복근', '덤벨', '덤벨 시티드 트위스트', '0'), ('복근', '덤벨', '덤벨 크런치', '0'), ('복근', '덤벨', '디클라인 덤벨 싯업', '0'), ('복근', '덤벨', '디클라인 덤벨 트위스트', '0'), ('복근', '덤벨', '덤벨 사이드 벤드', '0'), ('복근', '머신', '크런치 머신', '0'), ('복근', '케이블', '케이블 로프 크런치', '0'), ('복근', '케이블', '케이블 시티드 크런치', '0'), ('복근', '케이블', '케이블 리버스 크런치', '0'), ('복근', '케이블', '케이블 크런치', '0'), ('복근', '케틀벨', '케틀벨 사이드 벤드', '0'), ('복근', '밴드', '밴드 싯업', '0'), ('복근', '플레이트', '플레이트 크런치', '0'), ('복근', '플레이트', '플레이트 트위스트', '0'), ('복근', '플레이트', '디클라인 플레이트 크런치', '0'), ('복근', '플레이트', '디클라인 플레이트 트위스트', '0'), ('복근', '플레이트', '플레이트 사이드 벤드', '0'), ('복근', '플레이트', '플레이트 싯업', '0'), ('복근', '플레이트', '디클라인 플레이트 싯업', '0'), ('복근', '맨몸운동', '크런치', '1'), ('복근', '맨몸운동', '디클라인 트위스트', '1'), ('복근', '맨몸운동', '디클라인 크런치', '1'), ('복근', '맨몸운동', '레그 레이즈', '1'), ('복근', '맨몸운동', '싯업', '1'), ('복근', '맨몸운동', 'V업', '1'), ('복근', '맨몸운동', '시티드 니업', '1'), ('복근', '맨몸운동', '사이드 크런치', '1'), ('복근', '맨몸운동', '행잉 레그레이즈', '1'), ('복근', '기타', '메디슨 볼 쓰로우', '0'), ('복근', '기타', '메디슨 볼 오버헤드 쓰로우', '0'), ('유산소', '머신', '트레드밀(런닝머신)', '2'), ('유산소', '머신', '스텝퍼', '2'), ('유산소', '머신', '싸이클', '2'), ('유산소', '머신', '클라이머(천국의 계단)', '2'), ('유산소', '맨몸운동', '달리기(단계=시속)', '2')");
    })
    .catch((err) => {
        console.error(err);
    });

app.use(cors({
    credentials: true
}));

app.use(express.json());
app.use(express.urlencoded({extended: true}));
app.use(morgan(IS_DEV ? 'dev' : 'combined', {stream})); //개발 상태일 땐 'dev' 옵션, 배포 상태일 땐 'combined' 옵션 사용
app.use(cookieParser());
app.use('/', router);
app.use(notFound);
app.use(errorHandler);

//Server start
app.listen(app.get('port'), () => { 
    console.log(`Listening http://localhost:${app.get('port')} in ${app.get('env')} mode !!!`);
});